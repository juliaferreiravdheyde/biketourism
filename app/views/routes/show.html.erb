<div style="width: 100%; height: 450px;"
  data-controller="map"
  data-map-markers-value="<%= @markers.to_json %>"
  data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
</div>

<div class="container mt-4 mb-4">
  <% if @route.photos.attached?%>
    <div class="route-pictures">
      <% @route.photos.each do |photo| %>
        <%= cl_image_tag photo.key %>
      <% end %>
    </div>
<% end  %>
  <div class='route-creator d-flex align-items-center justify-content-between'>
    <h3>Created by <%= @route.creator.first_name %></h3>
    <% if @route.creator.photo.attached? %>
      <%= cl_image_tag current_user.photo.key, class: "avatar", alt: "dropdown menu" %>
    <% else %>
      <%= image_tag "user.svg", class: "avatar"%>
    <% end %>
  </div>
  <div class="route-details">
    <ul>
      <li>Name: <span><%= @route.name %></span></li>
      <li>Type of Route: <span><%= @route.type_of_route %></span></li>
      <li>Description: <span><%= @route.description %></span></li>
      <li>Distance: <span> <%= @route.distance < 1000 ? "#{@route.distance}m" : "#{(@route.distance / 1000.0).round(2)}km" %></span></li>
      <li>Elevation: <span> <%= @route.positive_elevation.nil? ? @route.positive_elevation : '60m' %></li>
    </ul>
  </div>


  <% if policy(@route).edit? %>
    <%= link_to "Edit", edit_route_path(@route), class: 'btn btn-primary' %>
  <% end %>
  <% if policy(@route).destroy? %>
    <%= link_to "Delete", route_path(@route), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: 'btn btn-danger' %>
  <% end %>

  <%if @ride_on_going.any? %>
      <%= link_to "Stop and Save", mark_as_done_route_ride_path(@route, @ride_on_going.first), remote: true, data: {turbo_method: :patch}, class: "btn btn-success" %>
  <% else %>
    <%= simple_form_for [@route,@ride] do |f| %>
      <%= f.submit "Start Route", class: "btn btn-success mb-3 mt-3"%>
    <% end %>
  <% end %>


  <%= simple_form_for @route, url: route_pinned_routes_path(@route), method: :post do |f| %>
    <%= f.submit "Pin your route", class: "btn btn-success mb-3"%>
  <% end %>

  <% if @favorite.present? %>
    <%= link_to favorite_path(@favorite.first), data: { turbo_method: :delete } do  %>
      <i class="fa-solid fa-heart"></i>
    <% end %>
  <% else %>
    <%= link_to route_favorites_path(@route), data: { turbo_method: :post } do  %>
      <i class="fa-regular fa-heart"></i>
    <% end %>
  <% end %>
</div>
